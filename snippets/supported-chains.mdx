export const SupportedChains = ({ endpoint, title, excludeChains }) => {
  const dataState = useState(null);
  const data = dataState[0];
  const setData = dataState[1];
  
  useEffect(function() {
    var url = "https://api.sim.dune.com/v1/evm/supported-chains";

    fetch(url, {
      method: "GET",
    })
      .then(function(response) {
        return response.json();
      })
      .then(function(responseData) {
        setData(responseData);
      });
  }, [endpoint]);

  if (data === null) {
    return <div>Loading chain information...</div>;
  }

  if (!data.chains) {
    return <div>No chain data available</div>;
  }

  var supportedChains = [];
  var totalChains = data.chains.length;
  var excludedChainNames = excludeChains || [];

  for (var i = 0; i < data.chains.length; i++) {
    var chain = data.chains[i];
    if (excludedChainNames.indexOf(chain.name) !== -1) continue;
    if (endpoint === undefined) {
      supportedChains.push(chain);
    } else if (chain[endpoint] && chain[endpoint].supported) {
      supportedChains.push(chain);
    }
  }

  var count = supportedChains.length;
  var endpointName = endpoint ? (endpoint.charAt(0).toUpperCase() + endpoint.slice(1).replace(/_/g, " ")) : "All";
  var accordionTitle = title ? (title + " (" + count + ")") : ("Supported Chains (" + count + ")");

  return (
    <Accordion title={accordionTitle}>
      <table>
        <thead>
          <tr>
            <th>name</th>
            <th>chain_id</th>
            <th>tags</th>
          </tr>
        </thead>
        <tbody>
          {supportedChains.map(function(chain) {
            return (
              <tr key={chain.name}>
                <td><code>{chain.name}</code></td>
                <td><code>{chain.chain_id}</code></td>
                <td><code>{chain.tags ? chain.tags.join(", ") : ""}</code></td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </Accordion>
  );
};
